{# Set up variant classes. #}
{% set variant_class = variant ? 'view-results--' ~ variant : 'view-results--default' %}

{% set list_type = list_type ?? 'ul' %}

{% set has_header = (form and not form_in_sidebar) or (header) %}
{% set has_footer = (footer is not empty) or (pager is not empty) or (footer_sidebar is not empty) %}

{% set divider = list_type_divider ? '' : 'no-divider' %}

{% set no_pager = pager ? '' : 'no-pager' %}

{% set footer_sidebar_class = footer_sidebar or items_per_page ? 'with-sidebar' : '' %}

{% set no_results_msg = no_results_msg ? no_results_msg : 'No results found. Please try another search.'|t %}

{# Create class array. #}
{# Include composable layout classes as needed. (stack, grid, center, etc.) #}
{# Include variant classes form above. #}
{% set classes = [
  'view-results',
  'container',
  no_pager,
  variant_class,
  has_header ? 'has-header' : 'no-header',
  has_footer ? 'has-footer' : 'no-footer',
  no_top_margin ? 'no-top-margin' : '',
  list_divider_skip_first ? 'list-divider-skip-first' : '',
  view_name,
  view_display,
] %}

{% set header_classes = [
  'view-results__header',
  form and form_in_sidebar ? 'with-sidebar' : '',
  sidebar_direction_header,
] %}

{% set results_classes = [
  'view-results__results',
  sidebar or form_in_sidebar ? 'with-sidebar' : '',
  sidebar_direction_results,
  divider,
] %}

<div class="{{ classes|join(' ') }}">

  {% if has_header %}
    <div class="{{ header_classes|join(' ') }}">
      {% if header_sidebar %}
        <div class="stack">
          {{ header_sidebar }}
        </div>
      {% endif %}

      <div class="stack">
        {% if form and not form_in_sidebar %}
          {{ form }}
        {% endif %}

        {% if header %}
          {{ header }}
        {% endif %}
      </div>
    </div>
  {% endif %}
  <div class="{{ results_classes|join(' ') }}">
    {% if sidebar or form_in_sidebar %}
      <div class="stack sidebar">
        {% if form_in_sidebar %}
          {{ form }}
        {% endif %}

        {% if sidebar %}
          {{ sidebar }}
        {% endif %}
      </div>
    {% endif %}
    {% if not custom_view %}
    <div class="stack content{% if variant == 'grouped_view' %} grouped-view{% endif %}">

      {% if rows -%}
        {% if content_header or items_per_page or list_label %}
          <div>
            {% if content_header or items_per_page%}
              <div class="cluster view-results_header_wrapper">
                <div class="views-results_content-header">{{ content_header }}</div>
                {% if items_per_page %}
                  <div class="alt-select-style items-per-page">
                    <div>{{ items_per_page }}</div>
                  </div>
                {% endif %}
              </div>
            {% endif %}
            {% if list_label  %}
              <h2 class="list-label">{{ list_label }}</h2>
            {% endif %}
          </div>
        {% endif %}

        <{{ list_type }} class="stack">
        {% if variant == 'grouped_view' %}
          
          {% for row in rows %}
            <li class="group-li">
              {% if row.list_label  %}
                <h3 class="list-label">{{ row.list_label }}</h3>
              {% endif %}

              <{{ list_type }} class="stack">
                {% for item in row.items %}
                  <li>
                    {% include "@molecules/ResultExcerpt/ResultExcerpt.twig" with {
                      brow: item.brow,
                      title: item.title,
                      has_section_header: list_label ? true : false,
                      content: item.content,
                      url: item.url,
                      aria_label: item.aria_label,
                      button_data: item.button_data,
                      detail_list_data: item.detail_list_data,
                      pills: item.pills,
                      main_file: item.main_file,
                      is_new: item.is_new,
                    } %}
                  </li>
                {% endfor %}
              </{{ list_type }}>
            </li>
          {% endfor %}
        {% else %}
          {% for row in rows %}
            <li>
              {% include "@molecules/ResultExcerpt/ResultExcerpt.twig" with {
                brow: row.brow,
                title: row.title,
                has_section_header: list_label,
                content: row.content,
                url: row.url,
                aria_label: row.aria_label,
                button_data: row.button_data,
                detail_list_data: row.detail_list_data,
                pills: row.pills,
                main_file: row.main_file,
                is_new: row.is_new,
              } %}
            </li>
          {% endfor %}
        {% endif %}
        </{{ list_type }}>
      {% elseif rows is empty -%}
        <div>
          {% if no_results_msg %}
            {{ no_results_msg }}
          {% else %}
            <p>{{ no_results_msg }}</p>
          {% endif %}
        </div>
     {% endif %}
     </div>
    {% else %}
     {# For future use #}  
    {% endif %}  
  </div>

  {% if has_footer %}
  <div class="view-results__footer {{ footer_sidebar_class }} {{ sidebar_direction_footer }}" >

    {% if footer_sidebar %}
    <div class="stack box alt-select-style">
      {{ footer_sidebar }}
    </div>
    {% endif %}

    {% if pager or footer %}

    <div class="stack">
      {% if pager is not empty %}
        {{ pager }}
      {% endif %}

      {% if footer %}
        {{ footer }}
      {% endif %}
    </div>
    {% endif %}

  </div>
  {% endif %}

</div>
